package com.example.androidexploit;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.util.Enumeration;
import java.util.zip.ZipEntry;
import java.util.zip.ZipFile;
import java.util.zip.ZipOutputStream;

import android.app.Activity;
import android.os.Bundle;
import android.widget.ScrollView;
import android.widget.TextView;


public class Main extends Activity {
	
	static ScrollView sv;
	static TextView tv;
	
	public static void log(String s) {
		tv.setText(":" + s + "\n");
	}
	
	
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		sv = new ScrollView(this);
		tv = new TextView(this);
		sv.addView(tv);
		setContentView(sv);
		
		try {
			main();
		} catch(Exception e) {
			throw new RuntimeException(e);
		}
		
	}
	
	public void main() throws Exception {
		ZipFile origApk = new ZipFile("/sdcard/blue.apk");
		ZipOutputStream zipOut = new ZipOutputStream(new FileOutputStream("/sdcard/blue-mod.apk"));
		
		Enumeration<? extends ZipEntry> entries = origApk.entries();
		while(entries.hasMoreElements()) {
			ZipEntry nextEntry = entries.nextElement();
			zipOut.putNextEntry(nextEntry);
			
			InputStream entryDataStream = origApk.getInputStream(nextEntry);
			byte buffer[] = new byte[4048];
			
			while(entryDataStream.available() > 0) {
				int length = entryDataStream.read(buffer);
				zipOut.write(buffer, 0, length);
			}
			zipOut.closeEntry();
		}
		
		zipOut.close();
		log("done");
		
	}
	
	

}
